<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>CVODE Trajectory Generator: CurvedTwoBody::rhsFunc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CVODE Trajectory Generator
   &#160;<span id="projectnumber">Version 1: Summer 2007</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="classCurvedTwoBody.html">CurvedTwoBody</a></li>  </ul>
</div>
</div><!-- top -->
<div class="contents">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td valign="top">
      <div class="navtab">
        <table>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_aef352e7fb271b83558b5c0dc51e2c619.html#aef352e7fb271b83558b5c0dc51e2c619">CurvedTwoBody</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_a30f5e5bdf2de6643a5d33435f4c32b48.html#a30f5e5bdf2de6643a5d33435f4c32b48">denseJac</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_a0bcff6cf12ab4e35ed850f4638ac82de.html#a0bcff6cf12ab4e35ed850f4638ac82de">getOptionString</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_a199e54df244b6e707ad1428d90ef29da.html#a199e54df244b6e707ad1428d90ef29da">getVectorSize</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_ae7463ee8866c29ea75e4ac1a144138c9.html#ae7463ee8866c29ea75e4ac1a144138c9">handleOption</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_aa5669c474886ba75d17addef3daf19e1.html#aa5669c474886ba75d17addef3daf19e1">recordData</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_a166ff775e4572bd2d506562cbd9f4cfd.html#a166ff775e4572bd2d506562cbd9f4cfd">recordDataInit</a></td></tr>
          <tr><td class="navtab"><a class="qindexHL" href="classCurvedTwoBody_a6e41ece8d9a097faa6cf00684976c99c.html#a6e41ece8d9a097faa6cf00684976c99c">rhsFunc</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_a013a54ef7dfbe554aee7fd0df6487ceb.html#a013a54ef7dfbe554aee7fd0df6487ceb">setCaptureRadius</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_ae7499dfcc4c15f142483fd7c32eacf5a.html#ae7499dfcc4c15f142483fd7c32eacf5a">setDeltaV</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_a7222a3aecf0dfd91196ed92e9014a97b.html#a7222a3aecf0dfd91196ed92e9014a97b">setInitialSeparation</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_aded44282503f87086bb75f07a9630970.html#aded44282503f87086bb75f07a9630970">setMassFraction</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_ad768a98ec9f5c81e6984d93def0fe664.html#ad768a98ec9f5c81e6984d93def0fe664">setSphereRadius</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classCurvedTwoBody_a77d962836f16bb5657196e636e15a68a.html#a77d962836f16bb5657196e636e15a68a">updateInitialVector</a></td></tr>
        </table>
      </div>
   </td>
   <td valign="top" class="mempage">
<a class="anchor" id="a6e41ece8d9a097faa6cf00684976c99c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int CurvedTwoBody::rhsFunc </td>
          <td>(</td>
          <td class="paramtype">realtype&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">N_Vector&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">N_Vector&#160;</td>
          <td class="paramname"><em>z_prime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>myself</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The CVODE callback function implementing the ODEs that represent this problem. </p>
<p>See <a class="el" href="classAbstractProblem_ae9ed44138493b8ff4783729c32a36525.html#ae9ed44138493b8ff4783729c32a36525" title="The right-hand side of the vector ODE, a callback from CVODE.">rhsFuncAbstract()</a> for details on the behavior and expectation of this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>The current time in the integration </td></tr>
    <tr><td class="paramname">z</td><td>The current "position" vector </td></tr>
    <tr><td class="paramname">z_prime</td><td>The current "velocity" vector </td></tr>
    <tr><td class="paramname">myself</td><td>A pointer to a TwoBodyCurved object, which is treated as if it were the "this" pointer. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="CurvedTwoBody_8cpp_source.html#l00020">20</a> of file <a class="el" href="CurvedTwoBody_8cpp_source.html">CurvedTwoBody.cpp</a>.</p>

<p>References <a class="el" href="AbstractProblem_8h_source.html#l00242">AbstractProblem::setError()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="classCurvedTwoBody.html" title="Implements the general two-body problem in a curved 2-dimensional universe.">CurvedTwoBody</a>* me = (<a class="code" href="classCurvedTwoBody.html" title="Implements the general two-body problem in a curved 2-dimensional universe.">CurvedTwoBody</a>*) myself;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype m1, m2, R;</div>
<div class="line">    </div>
<div class="line">    m1 = me-&gt;_mass_1;</div>
<div class="line">    m2 = me-&gt;_mass_2;</div>
<div class="line">    R = me-&gt;_sphere_radius;</div>
<div class="line"><span class="preprocessor">    #define G 1</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keyword">static</span> realtype theta1, theta2, phi1, phi2, theta1prime, theta2prime, </div>
<div class="line">                    phi1prime, phi2prime;</div>
<div class="line"></div>
<div class="line">    theta1 = Ith(y,1);</div>
<div class="line">    theta2 = Ith(y,2);</div>
<div class="line">    phi1 = Ith(y,3);</div>
<div class="line">    phi2 = Ith(y,4);</div>
<div class="line">    theta1prime = Ith(y,5);</div>
<div class="line">    theta2prime = Ith(y,6);</div>
<div class="line">    phi1prime = Ith(y,7);</div>
<div class="line">    phi2prime = Ith(y,8);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//calculate unit vectors</span></div>
<div class="line">    <span class="keyword">static</span> realtype r1Hat[3];</div>
<div class="line">    r1Hat[0] = sin(theta1) * cos(phi1);</div>
<div class="line">    r1Hat[1] = sin(theta1) * sin(phi1);</div>
<div class="line">    r1Hat[2] = cos(theta1);</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype r2Hat[3];</div>
<div class="line">    r2Hat[0] = sin(theta2) * cos(phi2);</div>
<div class="line">    r2Hat[1] = sin(theta2) * sin(phi2);</div>
<div class="line">    r2Hat[2] = cos(theta2);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> realtype theta1Hat[3];</div>
<div class="line">    theta1Hat[0] = cos(theta1) * cos(phi1);</div>
<div class="line">    theta1Hat[1] = cos(theta1) * sin(phi1);</div>
<div class="line">    theta1Hat[2] = -sin(theta1);</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype theta2Hat[3];</div>
<div class="line">    theta2Hat[0] = cos(theta2) * cos(phi2);</div>
<div class="line">    theta2Hat[1] = cos(theta2) * sin(phi2);</div>
<div class="line">    theta2Hat[2] = -sin(theta2);</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype phi1Hat[3];</div>
<div class="line">    phi1Hat[0] = -sin(phi1);</div>
<div class="line">    phi1Hat[1] = cos(phi1);</div>
<div class="line">    phi1Hat[2] = 0;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype phi2Hat[3];</div>
<div class="line">    phi2Hat[0] = -sin(phi2);</div>
<div class="line">    phi2Hat[1] = cos(phi2);</div>
<div class="line">    phi2Hat[2] = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// calculate forces</span></div>
<div class="line">    <span class="keyword">static</span> realtype r1Hat_r2Hat;</div>
<div class="line">    r1Hat_r2Hat = r1Hat[0] * r2Hat[0] + r1Hat[1] * r2Hat[1] + r1Hat[2] * r2Hat[2];  <span class="comment">//dot product of r1Hat and r2Hat</span></div>
<div class="line">    <span class="keyword">static</span> realtype delta;</div>
<div class="line">    delta = acos(r1Hat_r2Hat);  <span class="comment">// delta is angle between particles</span></div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (R*delta &lt; me-&gt;_capture_radius) {</div>
<div class="line">        me-&gt;<a class="code" href="classAbstractProblem_aea1611edc63ef6f61950740b08ada610.html#aea1611edc63ef6f61950740b08ada610" title="Set error message.">setError</a>(CAPTURE, <span class="stringliteral">&quot;Bodies Collided.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> realtype dShort, dLong, fMagnitude;</div>
<div class="line">    dShort = R*delta;       <span class="comment">//short distance between the two particles</span></div>
<div class="line">    dLong = R*(2*M_PI - delta); <span class="comment">//long distance between the two particles</span></div>
<div class="line">    fMagnitude = G*m1*m2 * (1/SQR(dShort) - 1/SQR(dLong));  <span class="comment">//magnitude of the gravitational force with wrap around</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> realtype p1Vec[3]; <span class="comment">//Gram - Schmidt process</span></div>
<div class="line">    p1Vec[X] = R*r2Hat[X] - R*r1Hat_r2Hat * r1Hat[X];</div>
<div class="line">    p1Vec[Y] = R*r2Hat[Y] - R*r1Hat_r2Hat * r1Hat[Y];</div>
<div class="line">    p1Vec[Z] = R*r2Hat[Z] - R*r1Hat_r2Hat * r1Hat[Z];</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype p2Vec[3];</div>
<div class="line">    p2Vec[X] = R*r1Hat[X] - R*r1Hat_r2Hat * r2Hat[X];</div>
<div class="line">    p2Vec[Y] = R*r1Hat[Y] - R*r1Hat_r2Hat * r2Hat[Y];</div>
<div class="line">    p2Vec[Z] = R*r1Hat[Z] - R*r1Hat_r2Hat * r2Hat[Z];</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype p1Mag, p2Mag;</div>
<div class="line">    p1Mag = sqrt (SQR(p1Vec[X]) +SQR(p1Vec[Y])+ SQR(p1Vec[Z]));</div>
<div class="line">    p2Mag = sqrt (SQR(p2Vec[X]) +SQR(p2Vec[Y])+ SQR(p2Vec[Z]));    </div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype f1Hat[3];</div>
<div class="line">    f1Hat[X] = p1Vec[X] / p1Mag;</div>
<div class="line">    f1Hat[Y] = p1Vec[Y]/p1Mag;</div>
<div class="line">    f1Hat[Z] = p1Vec[Z]/p1Mag;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype f2Hat[3]; <span class="comment">// force components in theta direction</span></div>
<div class="line">    f2Hat[X] = p2Vec[X] / p2Mag;</div>
<div class="line">    f2Hat[Y] = p2Vec[Y]/p2Mag;</div>
<div class="line">    f2Hat[Z] = p2Vec[Z]/p2Mag;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype f1Vec[3];</div>
<div class="line">    f1Vec[X] = f1Hat[X] * fMagnitude;</div>
<div class="line">    f1Vec[Y] = f1Hat[Y] * fMagnitude;</div>
<div class="line">    f1Vec[Z] = f1Hat[Z] * fMagnitude;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> realtype f2Vec[3];</div>
<div class="line">    f2Vec[X] = f2Hat[X] * fMagnitude;</div>
<div class="line">    f2Vec[Y] = f2Hat[Y] * fMagnitude;</div>
<div class="line">    f2Vec[Z] = f2Hat[Z] * fMagnitude;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype aVec1[3];</div>
<div class="line">    aVec1[X] = f1Vec[X]/m1;</div>
<div class="line">    aVec1[Y] = f1Vec[Y]/m1;</div>
<div class="line">    aVec1[Z] = f1Vec[Z]/m1;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype aVec2[3];</div>
<div class="line">    aVec2[X] = f2Vec[X]/m2;</div>
<div class="line">    aVec2[Y] = f2Vec[Y]/m2;</div>
<div class="line">    aVec2[Z] = f2Vec[Z]/m2;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype a1MechLin[2]; <span class="comment">//linear mechanical accelerations projections</span></div>
<div class="line">    a1MechLin[0] = aVec1[X]*theta1Hat[X] + aVec1[Y]*theta1Hat[Y] + aVec1[Z]*theta1Hat[Z]; <span class="comment">//acceleration in thetaHat</span></div>
<div class="line">    a1MechLin[1] = aVec1[X]*phi1Hat[X] + aVec1[Y]*phi1Hat[Y] + aVec1[Z]*phi1Hat[Z]; <span class="comment">//acceleration in phiHat</span></div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype a2MechLin[2]; <span class="comment">//linear mechanical accelerations projections</span></div>
<div class="line">    a2MechLin[0] = aVec2[X]*theta2Hat[X] + aVec2[Y]*theta2Hat[Y] + aVec2[Z]*theta2Hat[Z]; <span class="comment">//acceleration in thetaHat</span></div>
<div class="line">    a2MechLin[1] = aVec2[X]*phi2Hat[X] + aVec2[Y]*phi2Hat[Y] + aVec2[Z]*phi2Hat[Z]; <span class="comment">//acceleration in phiHat</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> realtype a1Mechanical[2]; <span class="comment">//angular mechanical acceleration projections</span></div>
<div class="line">    a1Mechanical[0] = a1MechLin[0]/R; <span class="comment">//acceleration in thetaHat</span></div>
<div class="line">    a1Mechanical[1] = a1MechLin[1]/(R*sin(theta1)); <span class="comment">//acceleration in phiHat</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> realtype a2Mechanical[2]; <span class="comment">// angular mechanical acceleration projections</span></div>
<div class="line">    a2Mechanical[0] = a2MechLin[0]/R; <span class="comment">//acceleration in thetaHat</span></div>
<div class="line">    a2Mechanical[1] = a2MechLin[1]/(R*sin(theta2)); <span class="comment">//acceleration in phiHat         </span></div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype a1Curvature[2]; <span class="comment">// effective acceleration due to curvature</span></div>
<div class="line">    a1Curvature[0] = cos(theta1)*sin(theta1)*SQR(phi1prime);</div>
<div class="line">    a1Curvature[1] = -2*(1/tan(theta1))*theta1prime*phi1prime;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype a2Curvature[2]; <span class="comment">// effective acceleration due to curvature</span></div>
<div class="line">    a2Curvature[0] = cos(theta2)*sin(theta2)*SQR(phi2prime);</div>
<div class="line">    a2Curvature[1] = -2*(1/tan(theta2))*theta2prime*phi2prime;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> realtype aTheta1, aPhi1;</div>
<div class="line">    aTheta1 = a1Mechanical[0] + a1Curvature[0];</div>
<div class="line">    aPhi1 = a1Mechanical[1] + a1Curvature[1];</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> realtype aTheta2, aPhi2;</div>
<div class="line">    aTheta2 = a2Mechanical[0] + a2Curvature[0];    </div>
<div class="line">    aPhi2 = a2Mechanical[1] + a2Curvature[1];</div>
<div class="line">    </div>
<div class="line">    Ith(ydot,1) = Ith(y,5);</div>
<div class="line">    Ith(ydot,2) = Ith(y,6); </div>
<div class="line">    Ith(ydot,3) = Ith(y,7); </div>
<div class="line">    Ith(ydot,4) = Ith(y,8); </div>
<div class="line">    Ith(ydot,5) = aTheta1;  </div>
<div class="line">    Ith(ydot,6) = aTheta2;  </div>
<div class="line">    Ith(ydot,7) = aPhi1;    </div>
<div class="line">    Ith(ydot,8) = aPhi2;    </div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
    </td>
  </tr>
</table>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 10 2013 18:56:32 for CVODE Trajectory Generator by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
